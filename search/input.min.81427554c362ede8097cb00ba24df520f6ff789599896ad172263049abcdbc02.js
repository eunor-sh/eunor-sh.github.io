"use strict";(function(){const e=document.querySelector("#book-search-input"),n=document.querySelector("#book-search-results"),t=document.querySelector("#book-search-modal"),o=document.querySelector("#book-search-trigger"),h=document.querySelector("#book-search-close");let a=!1,i=!1;if(!e||!n)return;e.addEventListener("focus",u),e.addEventListener("input",b),e.addEventListener("keydown",j),e.addEventListener("blur",m),e.addEventListener("compositionstart",g),e.addEventListener("compositionend",v),n.addEventListener("mousedown",p),o&&o.addEventListener("click",l),h&&h.addEventListener("click",c),t&&t.addEventListener("click",f),document.addEventListener("keydown",O);function O(t){if(t.defaultPrevented)return;if(y(t.target))return;if(e===document.activeElement)return;if(!t.key||t.key.length!==1)return;const n=t.key;if(!_(n))return;l(),t.preventDefault()}function _(t){const n=e.getAttribute("data-hotkeys")||"";return n.indexOf(t)>=0}function y(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=e.tagName?e.tagName.toLowerCase():"";return t==="input"||t==="textarea"||t==="select"}function j(e){e.key==="Escape"&&c()}function p(){i=!0}function m(){if(i){i=!1;return}r()}function f(e){e.target===t&&c()}function l(){t&&(t.classList.remove("hidden"),t.setAttribute("aria-hidden","false")),e.focus()}function c(){t&&(t.classList.add("hidden"),t.setAttribute("aria-hidden","true")),r(),e.value="",e.blur(),o&&o.blur()}function g(){a=!0}function v(){a=!1,s()}function b(){if(a)return;s()}function r(){for(;n.firstChild;)n.removeChild(n.firstChild)}function u(){e.removeEventListener("focus",u),e.required=!0,window.bookSearch.initIndex().then(()=>e.required=!1).then(s)}function s(){if(r(),!e.value)return;if(!window.bookSearchIndex){window.bookSearch.initIndex().then(s).catch(()=>{});return}const t=window.bookSearchIndex.search(e.value),o=t.slice(0,10);if(o.forEach(function(t){const s=d('<li class="book-search-result"><a href><div class="book-search-result-title"></div><div class="book-search-result-excerpt"></div></a></li>'),o=s.querySelector("a"),i=s.querySelector(".book-search-result-title"),a=s.querySelector(".book-search-result-excerpt");o.href=t.item.href,i.textContent=t.item.title,a.textContent=w(t.item.content,e.value),n.appendChild(s)}),t.length>10){const s=d('<li class="book-search-more"><a href></a></li>'),o=s.querySelector("a");o.href="/search/?q="+encodeURIComponent(e.value),o.textContent="더보기 (총 "+t.length+"개)",n.appendChild(s)}}function w(e,t){if(!e)return"";const n=e.replace(/\s+/g," ").trim(),o=t?t.trim():"";if(!o)return n.slice(0,180);const s=n.toLowerCase().indexOf(o.toLowerCase());if(s===-1)return n.slice(0,180);const i=Math.max(0,s-60),a=Math.min(n.length,s+120),r=i>0?"…":"",c=a<n.length?"…":"";return r+n.slice(i,a)+c}function d(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}})()